---
title: 【翻译】正则表达式可以更简单更快
tags:
- 翻译
---

# 简介
这是一个关于两种正则匹配的故事。其中一种在很多语言的标准解释器中被广泛的使用，包括perl在内。另一种只在很少的地方使用，大部分是在awk和grep中实现的。这两种方式有显著不同的性能体现：

![Time to match a?nan against an](https://swtch.com/~rsc/regexp/grep3p.png)
![Time to match a?nan against an](https://swtch.com/~rsc/regexp/grep4p.png)

让我们用上标表示字符重复，那么a？3a3就是a？a?a?aaa的简写。上面两个图画出了两种方法从an字符串中匹配出a？nan个字符的时间。

perl匹配一个29字符的需要超过60秒，另一种叫做Thompson NFA的方法需要20微秒。这不是原型。图中显示的时间perl在秒级别，Thompson 需要微秒；在29个字符串这么小的级别，Thompson 方法比比perl中的方法快一百万倍。图中显示这种趋势还会继续：Thompson 处理100字符串需要时间少于200ms，然而perl的方法可能需要超过10^15年。（perl只是许多常见的程序的中使用这种算法的一个；上面的图像可以在python，php，ruby和许多其他语言中。其他的实现方法的更详细的图像在文章后面展示。）

可能很难相信这个图像：或许你已经用过perl。他的正则表达式匹配并不是如此慢。大多数时间，在perl中的正则匹配也足够快。正如图像中展示的，也有可能写出一些所谓的「病理学」的正则表达式，会非常慢。于此相反的，在Thompson中不存在这样的病理学的正则表达。看着这个图片对比，我们会提出一个问题：为什么perl不使用Thomposon的方法呢？”他可以，他应该，这也是文章的后边讲的。

从历史角度来说，正则表达式是一个好的理论生成好的程序的计算机科学中的一个闪耀的明星。现代流行的工具实现的正则表达式比三十多年前的unix工具慢很多。

本文验证一个好理论：正则表达式，有限自动机和正则表达式在1960年代有Ken Thompson发明。他也把理论进行实践，描述了一个